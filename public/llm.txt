# ts-repair - Oracle-Guided TypeScript Repair Engine

> ts-repair turns TypeScript compiler diagnostics into verified repair plans for agents.
> Every fix is proven to reduce errors before your agent sees it.

## What is ts-repair?

ts-repair is an oracle-guided TypeScript repair engine. Instead of giving agents raw compiler errors and hoping they fix them, ts-repair:

1. Speculatively applies every candidate fix
2. Re-runs the TypeScript type checker
3. Only surfaces fixes that provably reduce errors

Agents receive a **verified repair plan** with ordered steps, not guesswork.

## How It Works

```
while diagnostics > 0:
  for each diagnostic, get candidate fixes
  for each candidate:
    apply to in-memory copy
    re-run type checker
    measure delta (errors removed - errors introduced)
  select best candidate (max delta)
  commit and repeat
```

## Installation

```bash
npm install -g ts-repair
```

## CLI Commands

```bash
# Get a verified repair plan
ts-repair repair ./tsconfig.json

# Output as JSON for agent consumption
ts-repair repair ./tsconfig.json --json

# Apply verified fixes automatically
ts-repair repair ./tsconfig.json --apply

# Generate a plan without applying
ts-repair plan -p tsconfig.json --format json

# Apply from a saved plan
ts-repair apply --plan plan.json

# Quick error check
ts-repair check -p tsconfig.json
```

## Scoring Strategies

- `--scoring-strategy delta` (default): Simple error count difference
- `--scoring-strategy weighted`: Considers severity, edit size, and risk

## MCP Server

Start the MCP server for agent integration:

```bash
ts-repair mcp-server
```

### MCP Tools

| Tool | Description |
|------|-------------|
| `ts_repair_plan` | Generate a verified TypeScript repair plan |
| `ts_repair_apply` | Apply verified repairs to files |
| `ts_repair_check` | Quick check for TypeScript error count |

### Agent Configuration

**Claude Code** (~/.claude/settings.json):
```json
{
  "mcpServers": {
    "ts-repair": {
      "command": "npx",
      "args": ["ts-repair", "mcp-server"]
    }
  }
}
```

**OpenCode** (opencode.json):
```json
{
  "mcp": {
    "ts-repair": {
      "type": "local",
      "command": ["npx", "ts-repair", "mcp-server"],
      "enabled": true
    }
  }
}
```

**Codex CLI** (~/.codex/config.toml):
```toml
[mcp_servers.ts-repair]
command = "npx"
args = ["ts-repair", "mcp-server"]
enabled = true
```

## Diagnostic Dispositions

After verification, each remaining diagnostic is classified:

| Disposition | Meaning | Agent Action |
|-------------|---------|--------------|
| **AutoFixable** | Verified fix exists, low risk | Apply automatically |
| **AutoFixableHighRisk** | Verified fix exists, semantic risk | Ask before applying |
| **NeedsJudgment** | Multiple valid fixes | Present options to user |
| **NoGeneratedCandidate** | No TypeScript fix available | Manual investigation needed |
| **NoVerifiedCandidate** | Fixes exist but none reduce errors | Root cause investigation needed |

## Programmatic API

```typescript
import { repair } from 'ts-repair';

const plan = await repair({
  project: './tsconfig.json',
  maxCandidates: 50,
  allowRegressions: false,
});

console.log(`${plan.initialErrors} â†’ ${plan.finalErrors} errors`);

for (const step of plan.steps) {
  console.log(`Apply: ${step.fix.name} @ ${step.file}:${step.line}`);
}
```

## Guarantees

- **Verified Fixes**: Every fix is proven by the TypeScript compiler to reduce errors
- **Monotonic Progress**: Each committed fix reduces the diagnostic count
- **Deterministic Output**: Same input yields the same repair plan

## Site Structure

- Homepage: https://ts-repair.ai/

## Documentation

- CLI Reference: https://github.com/ts-repair/ts-repair/blob/main/docs/CLI.md
- Agent Integration: https://github.com/ts-repair/ts-repair/blob/main/docs/AGENT_INTEGRATION.md
- Architecture: https://github.com/ts-repair/ts-repair/blob/main/docs/ARCHITECTURE.md

## Related Repositories

- Repair Engine: https://github.com/ts-repair/ts-repair
- Website: https://github.com/ts-repair/ts-repair.github.io

## Contact

Report issues: https://github.com/ts-repair/ts-repair/issues
